<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>早报 | Daily Morning</title>
    <style>
        :root {
            --sweet-pink: #ffaab2;          /* 你指定的颜色 */
            --soft-pink: #fff0f1;           /* 极浅粉背景 */
            --accent-yellow: #ffe66d;       /* 活力黄 */
            --text-color: #7a5c5f;          /* 棕粉色文字，比纯黑更温柔 */
            --card-bg: #ffffff;
            --radius: 20px;
        }

        body {
            font-family: "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            background: transparent;
            margin: 0;
            padding: 15px;
            color: var(--text-color);
        }

        /* 整体容器 */
        .container {
            max-width: 100%;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: 0 10px 30px rgba(255, 170, 178, 0.2);
            overflow: hidden;
            border: 3px solid var(--soft-pink);
        }

        /* 头部：圆润可爱 */
        .header {
            background: var(--sweet-pink);
            padding: 25px 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            margin: 0;
            color: white;
            font-size: 1.5rem;
            letter-spacing: 2px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.05);
        }

        #date-display {
            display: inline-block;
            margin-top: 10px;
            background: rgba(255, 255, 255, 0.3);
            color: white;
            padding: 4px 15px;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        /* 装饰性小圆点 */
        .header::after {
            content: "● ● ●";
            position: absolute;
            bottom: 8px;
            left: 0;
            right: 0;
            color: white;
            opacity: 0.5;
            font-size: 8px;
        }

        /* 语录：气泡感 */
        .weiyu-box {
            padding: 20px;
            background: var(--soft-pink);
            margin: 15px;
            border-radius: var(--radius);
            position: relative;
        }

        .weiyu-box::before {
            content: "“";
            position: absolute;
            top: 5px;
            left: 10px;
            font-size: 2rem;
            color: var(--sweet-pink);
            opacity: 0.4;
        }

        #weiyu-text {
            margin: 0;
            font-size: 0.95rem;
            line-height: 1.5;
            color: var(--text-color);
            position: relative;
            z-index: 1;
        }

        /* 音频控制台 */
        .audio-container {
            padding: 0 20px 15px;
        }

        audio {
            width: 100%;
            height: 40px;
            filter: sepia(20%) saturate(150%) hue-rotate(300deg); /* 给播放器染上粉色调 */
        }

        /* 新闻列表 */
        .news-list {
            padding: 0 15px 20px;
            list-style: none;
            margin: 0;
        }

        .news-item {
            background: #fff;
            margin-bottom: 12px;
            padding: 12px 15px;
            border-radius: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            border: 1px solid #fff5f6;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(255, 170, 178, 0.05);
        }

        .news-item:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(255, 170, 178, 0.15);
        }

        .news-index {
            flex-shrink: 0;
            width: 22px;
            height: 22px;
            background: var(--accent-yellow);
            color: #947600;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            margin-top: 2px;
        }

        .news-content {
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* 加载动画 */
        #loading {
            padding: 50px;
            text-align: center;
            color: var(--sweet-pink);
            font-weight: bold;
        }

        .loading-dots:after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
        }

        /* 自定义滚动条（针对 Chrome） */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--sweet-pink); border-radius: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>✨ 每日早报 ✨</h1>
            <div id="date-display">2026-02-17</div>
        </div>

        <div id="loading" class="loading-dots">正在为你打包资讯</div>

        <div id="content" style="display: none;">
            <div class="weiyu-box">
                <p id="weiyu-text"></p>
            </div>

            <div class="audio-container" id="audio-box" style="display: none;">
                <audio id="audio-control" controls></audio>
            </div>

            <ul id="news-list" class="news-list">
                </ul>
            
            <div style="text-align: center; padding-bottom: 20px; font-size: 12px; color: #ccc;">
                今日份美好已送达 ☁️
            </div>
        </div>
    </div>

    <script>
        const API_ENDPOINT = './data.json'; 
        const CACHE_KEY = 'zaobao_sweet_style';

        window.onload = function() {
            initNews();
        };

        async function initNews() {
            const loadingEl = document.getElementById('loading');
            const contentEl = document.getElementById('content');

            // 1. 尝试缓存
            const cachedDataStr = localStorage.getItem(CACHE_KEY);
            let hasRenderedCache = false;

            if (cachedDataStr) {
                try {
                    const cachedData = JSON.parse(cachedDataStr);
                    renderData(cachedData);
                    hasRenderedCache = true;
                    loadingEl.style.display = 'none';
                    contentEl.style.display = 'block';
                } catch (e) { console.error(e); }
            }

            // 2. 实时数据
            try {
                const response = await fetch(`${API_ENDPOINT}?t=${new Date().getTime()}`);
                const result = await response.json();

                if (result.code === 200 || result.success === true) {
                    renderData(result.data);
                    localStorage.setItem(CACHE_KEY, JSON.stringify(result.data));
                    loadingEl.style.display = 'none';
                    contentEl.style.display = 'block';
                }
            } catch (error) {
                if (!hasRenderedCache) {
                    loadingEl.textContent = "哎呀，网络开小差了 (っ °Д °;)っ";
                }
            }
        }

        function renderData(data) {
            document.getElementById('date-display').textContent = data.date;
            document.getElementById('weiyu-text').textContent = data.weiyu || "生活明朗，万物可爱。";

            const audioBox = document.getElementById('audio-box');
            const audioCtrl = document.getElementById('audio-control');
            if (data.audio) {
                audioBox.style.display = 'block';
                if (audioCtrl.src !== data.audio) audioCtrl.src = data.audio;
            }

            const newsList = document.getElementById('news-list');
            newsList.innerHTML = '';

            if (data.news) {
                data.news.forEach(itemStr => {
                    const li = document.createElement('li');
                    li.className = 'news-item';
                    
                    // 分离数字序号
                    const match = itemStr.match(/^(\d+)[、.](.*)/);
                    if (match) {
                        li.innerHTML = `
                            <div class="news-index">${match[1]}</div>
                            <div class="news-content">${match[2]}</div>
                        `;
                    } else {
                        li.innerHTML = `<div class="news-index">❤</div><div class="news-content">${itemStr}</div>`;
                    }
                    newsList.appendChild(li);
                });
            }
        }
    </script>
</body>
</html>
