<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>早报 | Blue Archive Style</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* 核心配色 - Blue Archive Momo Theme */
            --ba-pink: #ffaab2;
            --ba-pink-dark: #ff8e99;
            --ba-pink-light: #ffeef0;
            --ba-blue-accent: #6AD9F5; /* 经典的BA青蓝色点缀 */
            --ba-text: #4c5b70;        /* 更有质感的蓝灰色，不使用纯黑 */
            --ba-text-light: #8a9bb3;
            --glass-bg: rgba(255, 255, 255, 0.75); /* 主体透明度，可在此调整 */
            --glass-border: rgba(255, 255, 255, 0.9);
            --shadow: 0 8px 32px rgba(255, 170, 178, 0.15);
        }

        * { box-sizing: border-box; user-select: none; }

        body {
            margin: 0;
            padding: 20px;
            font-family: "M PLUS Rounded 1c", sans-serif;
            color: var(--ba-text);
            /* body 背景设为透明，以便 iframe 透出博客背景 */
            background: transparent; 
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }

        /* ─── 主容器：科技感卡片 ─── */
        .container {
            width: 100%;
            max-width: 600px;
            background: var(--glass-bg);
            backdrop-filter: blur(12px) saturate(120%);
            -webkit-backdrop-filter: blur(12px) saturate(120%);
            border-radius: 16px;
            border: 2px solid #fff;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            /* BA 风格左上角装饰斜角 */
            clip-path: polygon(
                0 0, 
                100% 0, 
                100% 100%, 
                20px 100%, 
                0 calc(100% - 20px)
            );
        }

        /* 顶部装饰条 */
        .top-deco-bar {
            height: 6px;
            background: repeating-linear-gradient(
                45deg,
                var(--ba-pink),
                var(--ba-pink) 10px,
                #fff 10px,
                #fff 20px
            );
            border-bottom: 2px solid #fff;
        }

        /* ─── 头部区域 ─── */
        .header {
            padding: 25px 20px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }

        /* 标题组 */
        .title-group h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 800;
            color: var(--ba-text);
            line-height: 1;
            font-style: italic;
            text-shadow: 2px 2px 0px #fff;
        }
        
        .title-group .sub-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--ba-pink);
            letter-spacing: 2px;
            margin-top: 4px;
            text-transform: uppercase;
        }

        /* 日期胶囊 */
        .date-capsule {
            background: #fff;
            padding: 6px 16px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 700;
            color: var(--ba-pink-dark);
            border: 2px solid var(--ba-pink-light);
            box-shadow: 0 4px 10px rgba(255,170,178, 0.2);
            position: relative;
            z-index: 2;
        }
        
        /* 装饰光环 (Halo) */
        .halo-deco {
            position: absolute;
            right: -20px;
            top: -30px;
            width: 120px;
            height: 120px;
            border: 2px solid rgba(106, 217, 245, 0.3); /* 青色光环 */
            border-radius: 50%;
            pointer-events: none;
        }
        .halo-deco::before {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 70%; height: 70%;
            border: 4px dashed rgba(255, 170, 178, 0.4);
            border-radius: 50%;
            animation: spin 20s linear infinite;
        }

        /* ─── 语录框：Momotalk 风格 ─── */
        .weiyu-wrapper {
            padding: 10px 20px;
        }
        
        .weiyu-card {
            background: rgba(255,255,255,0.85);
            border-left: 5px solid var(--ba-pink);
            border-radius: 4px 12px 12px 4px;
            padding: 15px;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
        }

        .weiyu-label {
            position: absolute;
            top: -10px;
            left: 10px;
            background: var(--ba-pink);
            color: #fff;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
            transform: rotate(-2deg);
        }

        #weiyu-text {
            margin: 0;
            font-size: 14px;
            line-height: 1.6;
            color: var(--ba-text);
            font-weight: 500;
        }

        /* ─── 音频播放器 ─── */
        .audio-wrapper {
            padding: 5px 20px;
            display: none; /* JS控制显示 */
        }
        audio {
            width: 100%;
            height: 36px;
            border-radius: 20px;
        }
        /* 自定义 webkit 播放器颜色 */
        audio::-webkit-media-controls-panel {
            background: var(--ba-pink-light);
        }

        /* ─── 新闻列表 ─── */
        .news-section {
            padding: 10px 20px 30px;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 10px;
        }
        .section-deco-dot {
            width: 8px; height: 8px;
            background: var(--ba-blue-accent);
            transform: rotate(45deg);
        }
        .section-title {
            font-size: 16px;
            font-weight: 800;
            color: var(--ba-text);
        }
        .section-line {
            flex: 1;
            height: 2px;
            background: repeating-linear-gradient(90deg, var(--ba-pink-light), var(--ba-pink-light) 4px, transparent 4px, transparent 8px);
        }

        .news-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .news-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(255,255,255,0.8);
            border-radius: 8px;
            padding: 10px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        /* 悬停效果：轻微上浮+发光 */
        .news-item:hover {
            transform: translateX(5px) translateY(-2px);
            background: #fff;
            box-shadow: 3px 3px 0px var(--ba-pink-light);
            border-color: var(--ba-pink);
        }

        /* 序号样式 */
        .news-index {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            background: var(--ba-text);
            color: #fff;
            font-weight: 800;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            margin-right: 12px;
            margin-top: 1px;
            /* 变成斜的 */
            transform: skewX(-10deg);
        }
        .news-index span {
            transform: skewX(10deg); /* 数字正回来 */
        }
        
        /* 前3名特殊颜色 */
        .news-item:nth-child(1) .news-index { background: var(--ba-pink); }
        .news-item:nth-child(2) .news-index { background: var(--ba-pink-dark); opacity: 0.9; }
        .news-item:nth-child(3) .news-index { background: var(--ba-pink-dark); opacity: 0.8; }

        .news-content {
            font-size: 14px;
            line-height: 1.5;
            color: var(--ba-text);
            font-weight: 500;
        }

        /* ─── 底部 & Loading ─── */
        .footer {
            text-align: center;
            font-size: 11px;
            color: var(--ba-text-light);
            padding-bottom: 15px;
            opacity: 0.7;
        }

        #loading {
            padding: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--ba-pink);
        }
        
        /* Loading 动画 - 模仿 BA 连接圈 */
        .loading-halo {
            width: 40px; height: 40px;
            border: 4px solid var(--ba-pink-light);
            border-top-color: var(--ba-pink);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* 入场动画 */
        .fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
            opacity: 0;
            transform: translateY(20px);
        }
        
        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }

        /* 滚动条美化 */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--ba-pink-light); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--ba-pink); }

    </style>
</head>
<body>

<div class="container">
    <div class="top-deco-bar"></div>
    
    <div class="header">
        <div class="halo-deco"></div> <div class="title-group">
            <h1>DAILY NEWS</h1>
            <div class="sub-title">Schale Office // Morning Brief</div>
        </div>
        <div class="date-capsule" id="date-display">System Check...</div>
    </div>

    <div id="loading">
        <div class="loading-halo"></div>
        <div style="font-weight: 700; letter-spacing: 1px;">CONNECTING...</div>
    </div>

    <div id="content" style="display: none;">
        
        <div class="weiyu-wrapper fade-in-up" style="animation-delay: 0.1s;">
            <div class="weiyu-card">
                <div class="weiyu-label">MomoTalk</div>
                <p id="weiyu-text">Loading thoughts...</p>
            </div>
        </div>

        <div class="audio-wrapper fade-in-up" id="audio-box" style="animation-delay: 0.2s;">
            <audio id="audio-control" controls></audio>
        </div>

        <div class="news-section">
            <div class="section-header fade-in-up" style="animation-delay: 0.2s;">
                <div class="section-deco-dot"></div>
                <div class="section-title">NEWS FEED</div>
                <div class="section-line"></div>
            </div>

            <ul id="news-list" class="news-list">
                </ul>
        </div>

        <div class="footer fade-in-up" style="animation-delay: 0.8s;">
            Designed for Sensei · Have a nice day
        </div>
    </div>
</div>

<script>
    // 保持原有逻辑不变，仅调整渲染 HTML 的结构
    const API_ENDPOINT = './data.json'; 
    const CACHE_KEY = 'zaobao_ba_style';

    window.onload = function () { initNews(); };

    async function initNews() {
        const loadingEl = document.getElementById('loading');
        const contentEl = document.getElementById('content');
        let hasRenderedCache = false;

        // 1. 尝试读取缓存
        const cachedDataStr = localStorage.getItem(CACHE_KEY);
        if (cachedDataStr) {
            try {
                const data = JSON.parse(cachedDataStr);
                // 简单的过期检查（可选）：如果日期不匹配今天，可视为失效，这里暂时直接渲染
                renderData(data);
                hasRenderedCache = true;
                loadingEl.style.display = 'none';
                contentEl.style.display = 'block';
            } catch (e) { console.error("Cache error", e); }
        }

        // 2. 网络请求
        try {
            const response = await fetch(`${API_ENDPOINT}?t=${Date.now()}`);
            const result = await response.json();
            
            // 兼容不同的 API 返回结构 (result.code or result.success)
            if (result.code === 200 || result.success === true || result.data) {
                const realData = result.data || result; // 容错处理
                renderData(realData);
                localStorage.setItem(CACHE_KEY, JSON.stringify(realData));
                
                // 确保移除 loading
                loadingEl.style.display = 'none';
                contentEl.style.display = 'block';
            }
        } catch (error) {
            console.error(error);
            if (!hasRenderedCache) {
                document.querySelector('#loading div:last-child').textContent = "CONNECTION FAILED";
                document.querySelector('.loading-halo').style.borderColor = "#ccc";
            }
        }
    }

    function renderData(data) {
        // 日期
        document.getElementById('date-display').textContent = data.date || new Date().toLocaleDateString();
        
        // 语录
        document.getElementById('weiyu-text').textContent = data.weiyu || "Sensei, work hard today!";

        // 音频
        const audioBox = document.getElementById('audio-box');
        const audioCtrl = document.getElementById('audio-control');
        if (data.audio) {
            audioBox.style.display = 'block';
            if (audioCtrl.src !== data.audio) audioCtrl.src = data.audio;
        } else {
            audioBox.style.display = 'none';
        }

        // 新闻列表
        const newsList = document.getElementById('news-list');
        newsList.innerHTML = '';

        if (data.news && Array.isArray(data.news)) {
            data.news.forEach((itemStr, index) => {
                const li = document.createElement('li');
                li.className = 'news-item fade-in-up';
                // 动画延迟，形成流水效果
                li.style.animationDelay = `${0.3 + (index * 0.05)}s`;

                // 尝试提取序号 (兼容 "1. xxx", "1、xxx" 或无序号)
                let num = index + 1;
                let content = itemStr;
                
                // 简单的正则匹配开头的数字
                const match = itemStr.match(/^(\d+)[、.](.*)/);
                if (match) {
                    num = match[1];
                    content = match[2].trim();
                }

                li.innerHTML = `
                    <div class="news-index"><span>${num}</span></div>
                    <div class="news-content">${content}</div>
                `;
                newsList.appendChild(li);
            });
        }
    }
</script>
</body>
</html>
